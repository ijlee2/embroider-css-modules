import { assert, normalizeFile, test } from '@codemod-utils/tests';

import { addLocalClasses } from '../../../../src/utils/css/index.js';
import {
  classNameToStyles,
  templateFile,
} from '../../../helpers/utils/css/complex-case-2.js';

test('utils | css | add-local-classes > complex case (2)', function () {
  let output = addLocalClasses(templateFile, {
    classNameToStyles,
    isHbs: false,
  });

  assert.strictEqual(
    output,
    normalizeFile([
      `<ContainerQuery`,
      `  @features={{hash wide=(width min=320)}}`,
      `  @tagName="article"`,
      `  class={{styles.container}}`,
      `  data-test-product-card`,
      `>`,
      `  <header class={{styles.header}}>`,
      `    <h2 class={{styles.name}} data-test-field="Name">`,
      `      {{@product.name}}`,
      `    </h2>`,
      `  </header>`,
      ``,
      `  <div class={{styles.image-container}}>`,
      `    <ProductsProductImage @src={{@product.imageUrl}} />`,
      `  </div>`,
      ``,
      `  <div class={{styles.body}}>`,
      `    <p`,
      `      class={{styles.description}}`,
      `      data-test-field="Short Description"`,
      `    >`,
      `      {{@product.shortDescription}}`,
      `    </p>`,
      ``,
      `    <p`,
      `      class={{styles.price}}`,
      `      data-test-field="Price"`,
      `    >`,
      `      {{formatPrice @product.price}}`,
      `    </p>`,
      `  </div>`,
      ``,
      `  <div class={{styles.actions}}>`,
      `    <LinkTo`,
      `      @model={{@product.id}}`,
      `      @route={{@redirectTo}}`,
      `      class={{styles.link}}`,
      `      data-test-link="Learn More"`,
      `    >`,
      `      Learn more`,
      `    </LinkTo>`,
      `  </div>`,
      `</ContainerQuery>`,
    ]),
  );

  output = addLocalClasses(templateFile, {
    classNameToStyles,
    isHbs: true,
  });

  assert.strictEqual(
    output,
    normalizeFile([
      `<ContainerQuery`,
      `  @features={{hash wide=(width min=320)}}`,
      `  @tagName="article"`,
      `  class={{this.styles.container}}`,
      `  data-test-product-card`,
      `>`,
      `  <header class={{this.styles.header}}>`,
      `    <h2 class={{this.styles.name}} data-test-field="Name">`,
      `      {{@product.name}}`,
      `    </h2>`,
      `  </header>`,
      ``,
      `  <div class={{this.styles.image-container}}>`,
      `    <ProductsProductImage @src={{@product.imageUrl}} />`,
      `  </div>`,
      ``,
      `  <div class={{this.styles.body}}>`,
      `    <p`,
      `      class={{this.styles.description}}`,
      `      data-test-field="Short Description"`,
      `    >`,
      `      {{@product.shortDescription}}`,
      `    </p>`,
      ``,
      `    <p`,
      `      class={{this.styles.price}}`,
      `      data-test-field="Price"`,
      `    >`,
      `      {{formatPrice @product.price}}`,
      `    </p>`,
      `  </div>`,
      ``,
      `  <div class={{this.styles.actions}}>`,
      `    <LinkTo`,
      `      @model={{@product.id}}`,
      `      @route={{@redirectTo}}`,
      `      class={{this.styles.link}}`,
      `      data-test-link="Learn More"`,
      `    >`,
      `      Learn more`,
      `    </LinkTo>`,
      `  </div>`,
      `</ContainerQuery>`,
    ]),
  );
});
